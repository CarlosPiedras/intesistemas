# Sistema de InternacionalizaciÃ³n (i18n) - Inte Sistemas

## ConfiguraciÃ³n next-intl

### InstalaciÃ³n

```bash
npm install next-intl
```

### Estructura de Archivos

```
public/
â””â”€â”€ locales/
    â”œâ”€â”€ es/
    â”‚   â”œâ”€â”€ common.json
    â”‚   â”œâ”€â”€ home.json
    â”‚   â”œâ”€â”€ about.json
    â”‚   â”œâ”€â”€ services.json
    â”‚   â”œâ”€â”€ portfolio.json
    â”‚   â”œâ”€â”€ contact.json
    â”‚   â””â”€â”€ footer.json
    â””â”€â”€ en/
        â”œâ”€â”€ common.json
        â”œâ”€â”€ home.json
        â”œâ”€â”€ about.json
        â”œâ”€â”€ services.json
        â”œâ”€â”€ portfolio.json
        â”œâ”€â”€ contact.json
        â””â”€â”€ footer.json
```

---

## ConfiguraciÃ³n

### 1. ConfiguraciÃ³n i18n

```ts
// src/lib/i18n/config.ts
export type Locale = (typeof locales)[number]

export const locales = ['es', 'en'] as const
export const defaultLocale: Locale = 'es'

export const localeNames: Record<Locale, string> = {
  es: 'EspaÃ±ol',
  en: 'English',
}

export const localeFlags: Record<Locale, string> = {
  es: 'ðŸ‡ªðŸ‡¸',
  en: 'ðŸ‡¬ðŸ‡§',
}
```

### 2. Request Configuration

```ts
// src/lib/i18n/request.ts
import { getRequestConfig } from 'next-intl/server'
import { notFound } from 'next/navigation'
import { locales } from './config'

export default getRequestConfig(async ({ locale }) => {
  // Validar locale
  if (!locales.includes(locale as any)) notFound()

  return {
    messages: (await import(`../../../public/locales/${locale}/common.json`)).default,
    timeZone: 'Europe/Madrid',
    now: new Date(),
  }
})
```

### 3. Middleware

```ts
// src/middleware.ts
import createMiddleware from 'next-intl/middleware'
import { locales, defaultLocale } from './lib/i18n/config'

export default createMiddleware({
  locales,
  defaultLocale,
  localePrefix: 'always', // Siempre mostrar /es/ o /en/ en URL
})

export const config = {
  // Coincidir con todas las rutas excepto api, _next/static, _next/image, favicon.ico
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)'],
}
```

### 4. Layout con Locale

```tsx
// app/[locale]/layout.tsx
import { NextIntlClientProvider } from 'next-intl'
import { notFound } from 'next/navigation'
import { locales } from '@/lib/i18n/config'

interface Props {
  children: React.ReactNode
  params: { locale: string }
}

export function generateStaticParams() {
  return locales.map((locale) => ({ locale }))
}

export default async function LocaleLayout({
  children,
  params: { locale },
}: Props) {
  // Validar locale
  if (!locales.includes(locale as any)) {
    notFound()
  }

  let messages
  try {
    messages = (await import(`../../../public/locales/${locale}/common.json`)).default
  } catch (error) {
    notFound()
  }

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  )
}
```

---

## Archivos de TraducciÃ³n

### Estructura JSON

```json
// public/locales/es/common.json
{
  "nav": {
    "home": "Inicio",
    "about": "Nosotros",
    "services": "Servicios",
    "portfolio": "Portfolio",
    "contact": "Contacto"
  },
  "buttons": {
    "submit": "Enviar",
    "cancel": "Cancelar",
    "readMore": "Leer mÃ¡s",
    "learnMore": "Conocer mÃ¡s",
    "getStarted": "Comenzar",
    "contactUs": "ContÃ¡ctanos"
  },
  "footer": {
    "about": "Sobre Inte Sistemas",
    "description": "Soluciones tecnolÃ³gicas empresariales de vanguardia",
    "quickLinks": "Enlaces RÃ¡pidos",
    "contact": "Contacto",
    "followUs": "SÃ­guenos",
    "rights": "Todos los derechos reservados",
    "privacy": "PolÃ­tica de Privacidad",
    "terms": "TÃ©rminos y Condiciones"
  },
  "common": {
    "loading": "Cargando...",
    "error": "Error",
    "success": "Ã‰xito",
    "name": "Nombre",
    "email": "Email",
    "phone": "TelÃ©fono",
    "message": "Mensaje",
    "address": "DirecciÃ³n",
    "company": "Empresa"
  }
}
```

```json
// public/locales/es/home.json
{
  "hero": {
    "title": "Soluciones TecnolÃ³gicas para Empresas del Futuro",
    "subtitle": "Transformamos tu negocio con tecnologÃ­a de vanguardia y experiencia comprobada",
    "cta": "Descubre mÃ¡s",
    "ctaSecondary": "ContÃ¡ctanos"
  },
  "services": {
    "title": "Nuestros Servicios",
    "subtitle": "Soluciones integrales para tu transformaciÃ³n digital",
    "webDev": {
      "title": "Desarrollo Web",
      "description": "Aplicaciones web modernas y escalables"
    },
    "consulting": {
      "title": "ConsultorÃ­a IT",
      "description": "Asesoramiento experto en tecnologÃ­a"
    },
    "cloud": {
      "title": "Cloud Computing",
      "description": "MigraciÃ³n y gestiÃ³n de infraestructura cloud"
    }
  },
  "stats": {
    "projects": "Proyectos Completados",
    "clients": "Clientes Satisfechos",
    "experience": "AÃ±os de Experiencia",
    "team": "Profesionales"
  }
}
```

```json
// public/locales/en/common.json
{
  "nav": {
    "home": "Home",
    "about": "About",
    "services": "Services",
    "portfolio": "Portfolio",
    "contact": "Contact"
  },
  "buttons": {
    "submit": "Submit",
    "cancel": "Cancel",
    "readMore": "Read more",
    "learnMore": "Learn more",
    "getStarted": "Get started",
    "contactUs": "Contact us"
  },
  "footer": {
    "about": "About Inte Sistemas",
    "description": "Cutting-edge enterprise technology solutions",
    "quickLinks": "Quick Links",
    "contact": "Contact",
    "followUs": "Follow us",
    "rights": "All rights reserved",
    "privacy": "Privacy Policy",
    "terms": "Terms and Conditions"
  },
  "common": {
    "loading": "Loading...",
    "error": "Error",
    "success": "Success",
    "name": "Name",
    "email": "Email",
    "phone": "Phone",
    "message": "Message",
    "address": "Address",
    "company": "Company"
  }
}
```

---

## Uso en Componentes

### Server Components

```tsx
// app/[locale]/page.tsx
import { useTranslations } from 'next-intl'

export default function HomePage() {
  const t = useTranslations('home')

  return (
    <section>
      <h1>{t('hero.title')}</h1>
      <p>{t('hero.subtitle')}</p>
      <button>{t('hero.cta')}</button>
    </section>
  )
}
```

### Client Components

```tsx
// components/LanguageSwitcher.tsx
'use client'

import { useLocale, useTranslations } from 'next-intl'
import { useRouter, usePathname } from 'next/navigation'
import { locales, localeNames } from '@/lib/i18n/config'

export function LanguageSwitcher() {
  const locale = useLocale()
  const router = useRouter()
  const pathname = usePathname()
  const t = useTranslations('common')

  const switchLocale = (newLocale: string) => {
    // Reemplazar locale en pathname
    const newPath = pathname.replace(`/${locale}`, `/${newLocale}`)
    router.push(newPath)
  }

  return (
    <div>
      {locales.map((loc) => (
        <button
          key={loc}
          onClick={() => switchLocale(loc)}
          className={locale === loc ? 'active' : ''}
        >
          {localeNames[loc]}
        </button>
      ))}
    </div>
  )
}
```

### Traducciones con Variables

```json
// public/locales/es/contact.json
{
  "form": {
    "successMessage": "Gracias {name}, hemos recibido tu mensaje. Te contactaremos pronto.",
    "errorMessage": "Error al enviar el mensaje. Intenta de nuevo.",
    "charactersRemaining": "{count, plural, =0 {Sin caracteres restantes} one {# caracter restante} other {# caracteres restantes}}"
  }
}
```

```tsx
// Uso
const t = useTranslations('contact')

// Con variables
t('form.successMessage', { name: 'Juan' })
// Output: "Gracias Juan, hemos recibido tu mensaje..."

// Con plurales
t('form.charactersRemaining', { count: 0 })
// Output: "Sin caracteres restantes"

t('form.charactersRemaining', { count: 1 })
// Output: "1 caracter restante"

t('form.charactersRemaining', { count: 50 })
// Output: "50 caracteres restantes"
```

### Rich Text (HTML)

```json
{
  "about": {
    "description": "Somos <strong>expertos</strong> en <em>desarrollo de software</em>."
  }
}
```

```tsx
import { useTranslations } from 'next-intl'

const t = useTranslations('about')

// Renderizar HTML (solo si confÃ­as en el contenido)
<p dangerouslySetInnerHTML={{ __html: t.raw('description') }} />
```

---

## Componentes Reutilizables

### Link Localizado

```tsx
// components/LocaleLink.tsx
import Link from 'next/link'
import { useLocale } from 'next-intl'

interface Props {
  href: string
  children: React.ReactNode
  className?: string
}

export function LocaleLink({ href, children, className }: Props) {
  const locale = useLocale()

  // AÃ±adir locale al href
  const localizedHref = `/${locale}${href}`

  return (
    <Link href={localizedHref} className={className}>
      {children}
    </Link>
  )
}

// Uso
<LocaleLink href="/services">Servicios</LocaleLink>
// Renderiza: /es/services o /en/services
```

### Formato de Fechas

```tsx
import { useFormatter } from 'next-intl'

export function DateDisplay({ date }: { date: Date }) {
  const format = useFormatter()

  return (
    <time dateTime={date.toISOString()}>
      {format.dateTime(date, {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      })}
    </time>
  )
}

// Output ES: "21 de noviembre de 2025"
// Output EN: "November 21, 2025"
```

### Formato de NÃºmeros y Moneda

```tsx
import { useFormatter } from 'next-intl'

export function PriceDisplay({ amount }: { amount: number }) {
  const format = useFormatter()

  return (
    <span>
      {format.number(amount, {
        style: 'currency',
        currency: 'EUR',
      })}
    </span>
  )
}

// Output ES: "1.234,56 â‚¬"
// Output EN: "â‚¬1,234.56"
```

---

## NavegaciÃ³n y Routing

### Generar Links Localizados

```tsx
// components/layout/Navigation.tsx
import { useTranslations, useLocale } from 'next-intl'
import Link from 'next/link'

export function Navigation() {
  const t = useTranslations('nav')
  const locale = useLocale()

  const links = [
    { href: '/', label: t('home') },
    { href: '/about', label: t('about') },
    { href: '/services', label: t('services') },
    { href: '/portfolio', label: t('portfolio') },
    { href: '/contact', label: t('contact') },
  ]

  return (
    <nav>
      {links.map((link) => (
        <Link
          key={link.href}
          href={`/${locale}${link.href}`}
          className="nav-link"
        >
          {link.label}
        </Link>
      ))}
    </nav>
  )
}
```

### RedirecciÃ³n con Locale

```tsx
'use client'

import { useRouter } from 'next/navigation'
import { useLocale } from 'next-intl'

export function NavigateButton() {
  const router = useRouter()
  const locale = useLocale()

  const handleNavigate = () => {
    router.push(`/${locale}/services`)
  }

  return <button onClick={handleNavigate}>Ver Servicios</button>
}
```

---

## SEO Multiidioma

### Metadatos por Locale

```tsx
// app/[locale]/page.tsx
import { Metadata } from 'next'

export async function generateMetadata({
  params: { locale },
}: {
  params: { locale: string }
}): Promise<Metadata> {
  const messages = (await import(`../../../public/locales/${locale}/home.json`))
    .default

  return {
    title: messages.meta.title,
    description: messages.meta.description,
    alternates: {
      canonical: `https://intesistemas.com/${locale}`,
      languages: {
        'es-ES': 'https://intesistemas.com/es',
        'en-US': 'https://intesistemas.com/en',
      },
    },
  }
}
```

### Hreflang en Layout

```tsx
// app/[locale]/layout.tsx
export async function generateMetadata({
  params: { locale },
}: {
  params: { locale: string }
}): Promise<Metadata> {
  return {
    alternates: {
      languages: {
        'es-ES': 'https://intesistemas.com/es',
        'en-US': 'https://intesistemas.com/en',
        'x-default': 'https://intesistemas.com/es',
      },
    },
  }
}
```

---

## Best Practices

### 1. OrganizaciÃ³n de Traducciones

```
âœ… Dividir por secciÃ³n/pÃ¡gina
common.json      â†’ Traducciones compartidas
home.json        â†’ EspecÃ­fico de home
services.json    â†’ EspecÃ­fico de servicios

âœ… Namespace jerÃ¡rquico
{
  "hero": {
    "title": "...",
    "subtitle": "..."
  },
  "services": {
    "item1": {
      "title": "...",
      "description": "..."
    }
  }
}
```

### 2. Claves Descriptivas

```json
// âŒ Claves crÃ­pticas
{
  "btn1": "Enviar",
  "txt2": "Nombre"
}

// âœ… Claves descriptivas
{
  "buttons": {
    "submit": "Enviar"
  },
  "form": {
    "nameLabel": "Nombre"
  }
}
```

### 3. Consistency Check

```bash
# Script para verificar consistencia entre idiomas
# scripts/check-translations.js
const es = require('../public/locales/es/common.json')
const en = require('../public/locales/en/common.json')

function getKeys(obj, prefix = '') {
  return Object.keys(obj).reduce((keys, key) => {
    const fullKey = prefix ? `${prefix}.${key}` : key
    if (typeof obj[key] === 'object') {
      return [...keys, ...getKeys(obj[key], fullKey)]
    }
    return [...keys, fullKey]
  }, [])
}

const esKeys = getKeys(es)
const enKeys = getKeys(en)

const missingInEn = esKeys.filter(key => !enKeys.includes(key))
const missingInEs = enKeys.filter(key => !esKeys.includes(key))

if (missingInEn.length) {
  console.error('Missing in EN:', missingInEn)
}

if (missingInEs.length) {
  console.error('Missing in ES:', missingInEs)
}
```

### 4. Fallback y Valores por Defecto

```tsx
// Siempre proporcionar fallback
t('key.that.might.not.exist', { defaultValue: 'Texto por defecto' })

// O verificar existencia
{t.has('optional.key') && <span>{t('optional.key')}</span>}
```

---

## Agregar Nuevo Idioma

### Paso 1: Agregar a ConfiguraciÃ³n

```ts
// src/lib/i18n/config.ts
export const locales = ['es', 'en', 'fr'] as const // AÃ±adir 'fr'

export const localeNames: Record<Locale, string> = {
  es: 'EspaÃ±ol',
  en: 'English',
  fr: 'FranÃ§ais', // AÃ±adir
}
```

### Paso 2: Crear Archivos de TraducciÃ³n

```bash
mkdir -p public/locales/fr
cp public/locales/es/*.json public/locales/fr/
# Traducir manualmente cada archivo
```

### Paso 3: Actualizar Middleware

El middleware ya toma los locales de config.ts, no requiere cambios.

### Paso 4: Actualizar SEO

```tsx
// AÃ±adir hreflang para nuevo idioma
alternates: {
  languages: {
    'es-ES': 'https://intesistemas.com/es',
    'en-US': 'https://intesistemas.com/en',
    'fr-FR': 'https://intesistemas.com/fr', // Nuevo
  },
}
```

---

## Testing i18n

```tsx
// __tests__/i18n.test.tsx
import { render, screen } from '@testing-library/react'
import { NextIntlClientProvider } from 'next-intl'
import HomePage from '@/app/[locale]/page'

describe('i18n', () => {
  it('renders in Spanish', () => {
    const messages = require('../public/locales/es/home.json')

    render(
      <NextIntlClientProvider locale="es" messages={messages}>
        <HomePage />
      </NextIntlClientProvider>
    )

    expect(screen.getByText(messages.hero.title)).toBeInTheDocument()
  })

  it('renders in English', () => {
    const messages = require('../public/locales/en/home.json')

    render(
      <NextIntlClientProvider locale="en" messages={messages}>
        <HomePage />
      </NextIntlClientProvider>
    )

    expect(screen.getByText(messages.hero.title)).toBeInTheDocument()
  })
})
```

---

## Herramientas Ãštiles

- **i18n Ally** (VS Code Extension): EdiciÃ³n inline de traducciones
- **POEditor / Lokalise**: Plataformas de gestiÃ³n de traducciones
- **DeepL API**: TraducciÃ³n automÃ¡tica de alta calidad
- **Translation Manager**: Scripts personalizados para gestiÃ³n

---

**Fecha:** 2025-11-21
**Idiomas soportados:** ES, EN
**PrÃ³xima expansiÃ³n:** FR (futuro)
