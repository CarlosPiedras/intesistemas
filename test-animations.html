<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test de Animaciones - Intesistemas</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
    }

    .test-panel {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #1175c7;
      color: white;
      padding: 1rem;
      z-index: 9999;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .test-panel h1 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .test-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }

    .test-buttons button {
      padding: 0.5rem 1rem;
      border: none;
      background: white;
      color: #1175c7;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .test-buttons button:hover {
      background: #e6f4ff;
    }

    .test-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.5rem;
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

    .test-info div {
      background: rgba(255,255,255,0.1);
      padding: 0.5rem;
      border-radius: 4px;
    }

    .test-iframe {
      margin-top: 140px;
      width: 100%;
      height: calc(100vh - 140px);
      border: none;
    }

    .problem {
      color: #ff6b6b;
      font-weight: bold;
    }

    .ok {
      color: #51cf66;
      font-weight: bold;
    }

    #log {
      max-height: 100px;
      overflow-y: auto;
      background: rgba(0,0,0,0.2);
      padding: 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      margin-top: 0.5rem;
      font-family: monospace;
    }

    .log-entry {
      margin: 2px 0;
    }

    .log-error {
      color: #ff6b6b;
    }

    .log-ok {
      color: #51cf66;
    }

    .log-info {
      color: #74c0fc;
    }
  </style>
</head>
<body>
  <div class="test-panel">
    <h1>ðŸ§ª Test de Visibilidad de Animaciones - Intesistemas</h1>

    <div class="test-buttons">
      <button onclick="navigate('/')">Home</button>
      <button onclick="navigate('/about')">About</button>
      <button onclick="navigate('/servicios')">Servicios</button>
      <button onclick="navigate('/servicios/automatizacion-industrial')">AutomatizaciÃ³n</button>
      <button onclick="navigate('/servicios/distribucion-energia')">DistribuciÃ³n</button>
      <button onclick="navigate('/contacto')">Contacto</button>
      <button onclick="checkVisibility()">âœ“ Verificar Visibilidad</button>
      <button onclick="scrollTest()">ðŸ”„ Test Scroll</button>
    </div>

    <div class="test-info">
      <div>
        <strong>URL:</strong> <span id="currentUrl">-</span>
      </div>
      <div>
        <strong>H1 Visibles:</strong> <span id="h1Count">-</span>
      </div>
      <div>
        <strong>H1 Invisibles:</strong> <span id="h1Invisible" class="problem">-</span>
      </div>
      <div>
        <strong>Elementos opacity:0:</strong> <span id="opacityZero" class="problem">-</span>
      </div>
    </div>

    <div id="log"></div>
  </div>

  <iframe id="testFrame" class="test-iframe" src="http://localhost:3000"></iframe>

  <script>
    const frame = document.getElementById('testFrame');
    const log = document.getElementById('log');
    let checkInterval;

    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.insertBefore(entry, log.firstChild);

      // Mantener solo Ãºltimas 20 lÃ­neas
      while (log.children.length > 20) {
        log.removeChild(log.lastChild);
      }
    }

    function navigate(path) {
      frame.src = `http://localhost:3000${path}`;
      document.getElementById('currentUrl').textContent = path;
      addLog(`Navegando a: ${path}`, 'info');

      // Verificar visibilidad despuÃ©s de cargar
      frame.onload = () => {
        addLog(`PÃ¡gina cargada: ${path}`, 'info');
        setTimeout(() => checkVisibility(), 200);
      };
    }

    function checkVisibility() {
      try {
        const doc = frame.contentDocument || frame.contentWindow.document;

        // Verificar H1
        const h1Elements = doc.querySelectorAll('h1');
        let h1Visible = 0;
        let h1Invisible = 0;

        h1Elements.forEach((h1) => {
          const style = window.getComputedStyle(h1);
          const opacity = parseFloat(style.opacity);
          const rect = h1.getBoundingClientRect();

          // Solo contar si estÃ¡ en viewport
          if (rect.top >= 0 && rect.top < frame.contentWindow.innerHeight) {
            if (opacity > 0) {
              h1Visible++;
            } else {
              h1Invisible++;
              addLog(`âŒ H1 invisible: "${h1.textContent.substring(0, 50)}..." (opacity: ${opacity})`, 'error');
            }
          }
        });

        document.getElementById('h1Count').textContent = h1Visible;
        document.getElementById('h1Invisible').textContent = h1Invisible;

        // Verificar todos los elementos con opacity 0 en viewport
        const allElements = doc.querySelectorAll('h1, h2, h3, [class*="fade"], [class*="slide"], [class*="motion"]');
        let opacityZeroCount = 0;

        allElements.forEach((el) => {
          const style = window.getComputedStyle(el);
          const opacity = parseFloat(style.opacity);
          const rect = el.getBoundingClientRect();

          // Si estÃ¡ en viewport y tiene opacity 0
          if (
            rect.top >= 0 &&
            rect.top < frame.contentWindow.innerHeight &&
            opacity === 0
          ) {
            opacityZeroCount++;
            const text = el.textContent.substring(0, 30);
            addLog(`âŒ ${el.tagName} invisible en viewport: "${text}..." (opacity: 0)`, 'error');
          }
        });

        document.getElementById('opacityZero').textContent = opacityZeroCount;

        if (h1Invisible === 0 && opacityZeroCount === 0) {
          addLog('âœ… Todos los elementos visibles correctamente', 'ok');
        } else {
          addLog(`âš ï¸ Problemas detectados: ${h1Invisible} H1 + ${opacityZeroCount} elementos invisibles`, 'error');
        }

      } catch (e) {
        addLog(`Error: ${e.message}`, 'error');
      }
    }

    async function scrollTest() {
      addLog('ðŸ”„ Iniciando test de scroll...', 'info');
      const win = frame.contentWindow;

      // PosiciÃ³n inicial
      win.scrollTo(0, 0);
      await sleep(300);
      checkVisibility();
      addLog('PosiciÃ³n: Top', 'info');

      // Scroll hacia abajo
      await sleep(500);
      win.scrollTo(0, 500);
      await sleep(300);
      addLog('PosiciÃ³n: Abajo (500px)', 'info');

      // Scroll hacia arriba (aquÃ­ deberÃ­an aparecer los elementos)
      await sleep(500);
      win.scrollTo(0, 0);
      await sleep(300);
      addLog('PosiciÃ³n: Top de nuevo', 'info');
      checkVisibility();

      addLog('âœ… Test de scroll completado', 'ok');
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // VerificaciÃ³n automÃ¡tica cada 2 segundos
    checkInterval = setInterval(() => {
      if (frame.contentDocument) {
        checkVisibility();
      }
    }, 2000);

    // Primera carga
    frame.onload = () => {
      setTimeout(() => checkVisibility(), 500);
    };

    addLog('ðŸš€ Test de animaciones iniciado', 'ok');
    addLog('AsegÃºrate de que tu servidor de desarrollo estÃ© corriendo en http://localhost:3000', 'info');
  </script>
</body>
</html>
